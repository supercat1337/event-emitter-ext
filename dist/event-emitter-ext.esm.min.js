var u=class{#t=new Map;#h=!1;autoRegister=!1;#i=new Map;#f=-1;#s=new Map;#e=new Map;#n(e){let t=++this.#f;return this.#s.set(t,e),this.#e.set(t,0),t}#a(e){this.#s.delete(e)}#l(e){for(let[t,s]of this.#s)if(s===e)return t;return-1}#u(e,t){let s=this.#t.get(e);if(s===void 0)return;s.add(t),this.#e.has(t)||this.#e.set(t,0);let i=this.#e.get(t)||0;i++,this.#e.set(t,i)}#r(e,t){let s=this.#t.get(e);if(s===void 0||(s.delete(t),!this.#e.has(t)))return;let i=this.#e.get(t)||0;i--,this.#e.set(t,i),this.#o(t)}#o(e){if(!this.#s.has(e))return;let t=this.#e.get(e)||0;if(t!==void 0&&t==0){this.#a(e),this.#e.delete(e);return}}mute(){this.#h=!0}unmute(){this.#h=!1,this.#c()}isMuted(){return this.#h}#c(){if(this.#i.size===0)return;let e=new Set;this.#t.forEach((t,s)=>{if(this.#i.has(s)){let i=this.#i.get(s)||[];t.forEach(r=>{let h=this.#s.get(r);h!==void 0&&(e.has(r)||(e.add(r),h(...i)))}),this.#i.delete(s)}})}registerEvents(...e){e.forEach(t=>{this.#t.has(t)||this.#t.set(t,new Set)})}unregisterEvents(...e){e.forEach(t=>{if(!this.#t.has(t))return;let s=this.#t.get(t);s&&(s.forEach(i=>{this.#r(t,i)}),this.#t.delete(t))})}unregisterAllEvents(){this.#t.clear(),this.#s.clear(),this.#e.clear(),this.#i.clear()}on(e,t){let s=()=>{};if(this.autoRegister==!1){if(!this.#t.has(e))return s}else this.registerEvents(e);let i=this.#n(t);this.#u(e,i);let r=this;return function(){r.#r(e,i)}}onAny(e,t){let s=this.#n(t);return e.forEach(i=>{this.#u(i,s)}),()=>{e.forEach(i=>{this.#r(i,s)})}}removeListener(e,t){if(!this.#t.has(e))return;let s=this.#l(t);s!=-1&&this.#r(e,s)}removeAllListeners(e){this.#t.has(e)&&this.#t.get(e).forEach(t=>{this.#r(e,t)})}off(e,t){this.removeListener(e,t)}hasEvent(e){return this.#t.has(e)}hasListeners(e){return this.#t.has(e)&&this.#t.get(e).size>0}getNumberOfListeners(e){let t=this.#t.get(e);return t===void 0?0:t.size}emit(e,...t){if(this.#t.has(e))if(this.#h){this.#i.set(e,t);return}else this.#d(e,...t)}#d(e,...t){let s=this.#t.get(e);s!==void 0&&s.forEach(i=>{try{let r=this.#s.get(i);if(r===void 0)return;r.apply(this,t)}catch(r){console.error(e,t),console.error(r)}})}emitMany(e,...t){this.#t.forEach((s,i)=>{let r=i;e.includes(r)&&this.emit(r,...t)})}once(e,t){let s=this,i=this.on(e,function(){i(),t.apply(s,arguments)});return i}waitForEvent(e,t=0){return new Promise(s=>{let i,r=this.on(e,()=>{t>0&&clearTimeout(i),r(),s(!0)});t>0&&(i=setTimeout(()=>{r(),s(!1)},t))})}waitForAnyEvent(e,t=0){return new Promise(s=>{let i,r=[],h=()=>{t>0&&clearTimeout(i),r.forEach(n=>{n()}),s(!0)};e.forEach(n=>{r.push(this.on(n,h))}),t>0&&(i=setTimeout(()=>{h(),s(!1)},t))})}};export{u as EventEmitterExt};
