var a=0,o=1,l=class{#t=new Map;#n=!1;autoRegister=!1;#s=new Map;#f=-1;#r=new Map;#e=new Map;#i=!1;#l=1;setListenerRunnerStrategy(t){this.#l=t}getListenerRunnerStrategy(){return this.#l}#u(t){let e=++this.#f;return this.#r.set(e,t),this.#e.set(e,0),e}#c(t){this.#r.delete(t)}#E(t){for(let[e,s]of this.#r)if(s===t)return e;return-1}#a(t,e){(this.#t.get(t)||new Set).add(e);let r=this.#e.get(e)||0;r++,this.#e.set(e,r)}#h(t,e){(this.#t.get(t)||new Set).delete(e);let r=this.#e.get(e)||1;r--,this.#e.set(e,r),this.#g(e)}#g(t){if((this.#e.get(t)||0)==0){this.#c(t),this.#e.delete(t);return}}mute(){this.#n=!0}unmute(){this.#n=!1,this.#o()}isMuted(){return this.#n}#o(){if(this.#s.size===0)return;this.#i=!0;let t=new Map;this.#t.forEach((s,r)=>{if(this.#s.has(r)){let i=this.#s.get(r)||[];s.forEach(n=>{t.set(n,i)})}}),this.#s.clear();let e=Array.from(t.keys());this.#l==0&&e.sort((s,r)=>s-r),e.forEach(s=>{let r=t.get(s)||[],i=this.#r.get(s);try{i&&i(...r)}catch(n){console.error(n)}}),this.#i=!1}registerEvents(...t){t.forEach(e=>{this.#t.has(e)||this.#t.set(e,new Set)})}unregisterEvents(...t){t.forEach(e=>{if(!this.#t.has(e))return;let s=this.#t.get(e);s&&(s.forEach(r=>{this.#h(e,r)}),this.#t.delete(e))})}unregisterAllEvents(){this.#t.clear(),this.#r.clear(),this.#e.clear(),this.#s.clear()}on(t,e){let s=()=>{};if(this.autoRegister==!1){if(!this.#t.has(t))return s}else this.registerEvents(t);let r=this.#u(e);this.#a(t,r);let i=this;return function(){i.#h(t,r)}}onAny(t,e){this.autoRegister==!0&&this.registerEvents(...t);let s=Array.from(t).filter(i=>this.#t.has(i));if(s.length==0)return()=>{};let r=this.#u(e);return s.forEach(i=>{this.#a(i,r)}),()=>{s.forEach(i=>{this.#h(i,r)})}}removeListener(t,e){if(!this.#t.has(t))return;let s=this.#E(e);s!=-1&&this.#h(t,s)}removeAllListeners(t){if(!this.#t.has(t))return;(this.#t.get(t)||new Set).forEach(s=>{this.#h(t,s)})}off(t,e){this.removeListener(t,e)}hasEvent(t){return this.#t.has(t)}hasListeners(t){return(this.#t.get(t)||new Set).size>0}getNumberOfListeners(t){return(this.#t.get(t)||new Set).size}emit(t,...e){if(this.#i)throw new Error("Cannot call emit while listeners are running");this.#t.has(t)&&(this.#n?this.#s.set(t,e):this.#R(t,...e))}#R(t,...e){let s=this.#t.get(t)||new Set;this.#i=!0,s.forEach(r=>{try{let i=this.#r.get(r);i&&i(...e)}catch(i){console.error(t,e),console.error(i)}}),this.#i=!1}emitMany(t,...e){if(this.#i)throw new Error("Cannot call emitMany while listeners are running");t.forEach(s=>{this.#t.has(s)&&this.#s.set(s,e)}),this.#n||this.#o()}once(t,e){let s=this,r=this.on(t,function(){r(),e.apply(s,arguments)});return r}waitForEvent(t,e=0){return new Promise(s=>{let r,i=this.on(t,()=>{e>0&&clearTimeout(r),i(),s(!0)});e>0&&(r=setTimeout(()=>{i(),s(!1)},e))})}waitForAnyEvent(t,e=0){return new Promise(s=>{let r,i=[],n=()=>{e>0&&clearTimeout(r),i.forEach(h=>{h()}),s(!0)};t.forEach(h=>{i.push(this.on(h,n))}),e>0&&(r=setTimeout(()=>{n(),s(!1)},e))})}getListeners(t){if(!this.#t.has(t))return[];let e=this.#t.get(t)||new Set,s=[];return e.forEach(r=>{let i=this.#r.get(r);i&&s.push(i)}),s}getEventNames(){return Array.from(this.#t.keys())}};export{l as EventEmitterExt,o as STRATEGY_ORDERED_BY_EVENTS,a as STRATEGY_ORDERED_BY_LISTENER_ID};
