var u=class{events=new Map;#r=!1;autoRegister=!1;#s=new Map;#u=-1;#t=new Map;#e=new Map;#n(t){let e=++this.#u;return this.#t.set(e,t),this.#e.set(e,0),e}#f(t){this.#t.delete(t)}#l(t){for(let[e,s]of this.#t)if(s===t)return e;return-1}#h(t,e){let s=this.events.get(t);if(s===void 0)return;s.add(e),this.#e.has(e)||this.#e.set(e,0);let i=this.#e.get(e)||0;i++,this.#e.set(e,i)}#i(t,e){let s=this.events.get(t);if(s===void 0||(s.delete(e),!this.#e.has(e)))return;let i=this.#e.get(e)||0;i--,this.#e.set(e,i),this.#o(e)}#o(t){if(!this.#t.has(t))return;let e=this.#e.get(t)||0;if(e!==void 0&&e==0){this.#f(t),this.#e.delete(t);return}}mute(){this.#r=!0}unmute(){this.#r=!1,this.#a()}isMuted(){return this.#r}#a(){if(this.#s.size===0)return;let t=new Set;this.events.forEach((e,s)=>{if(this.#s.has(s)){let i=this.#s.get(s)||[];e.forEach(r=>{let n=this.#t.get(r);n!==void 0&&(t.has(r)||(t.add(r),n(...i)))}),this.#s.delete(s)}})}registerEvents(...t){t.forEach(e=>{this.events.has(e)||this.events.set(e,new Set)})}unregisterEvents(...t){t.forEach(e=>{if(!this.events.has(e))return;let s=this.events.get(e);s&&(s.forEach(i=>{this.#i(e,i)}),this.events.delete(e))})}unregisterAllEvents(){this.events.clear(),this.#t.clear(),this.#e.clear(),this.#s.clear()}on(t,e){let s=()=>{};if(this.autoRegister==!1){if(!this.events.has(t))return s}else this.registerEvents(t);let i=this.#n(e);this.#h(t,i);let r=this;return function(){r.#i(t,i)}}onAny(t,e){let s=this.#n(e);return t.forEach(i=>{this.#h(i,s)}),()=>{t.forEach(i=>{this.#i(i,s)})}}removeListener(t,e){if(!this.events.has(t))return;let s=this.#l(e);s!=-1&&this.#i(t,s)}removeAllListeners(t){this.events.has(t)&&this.events.get(t).forEach(e=>{this.#i(t,e)})}off(t,e){this.removeListener(t,e)}emit(t,...e){if(this.events.has(t))if(this.#r){this.#s.set(t,e);return}else this.#c(t,...e)}#c(t,...e){let s=this.events.get(t);s!==void 0&&s.forEach(i=>{try{let r=this.#t.get(i);if(r===void 0)return;r.apply(this,e)}catch(r){console.error(t,e),console.error(r)}})}emitMany(t,...e){this.events.forEach((s,i)=>{let r=i;t.includes(r)&&this.emit(r,...e)})}once(t,e){let s=this,i=this.on(t,function(){i(),e.apply(s,arguments)});return i}waitForEvent(t,e=0){return new Promise(s=>{let i,r=this.on(t,()=>{e>0&&clearTimeout(i),r(),s(!0)});e>0&&(i=setTimeout(()=>{r(),s(!1)},e))})}waitForAnyEvent(t,e=0){return new Promise(s=>{let i,r=[],n=()=>{e>0&&clearTimeout(i),r.forEach(h=>{h()}),s(!0)};t.forEach(h=>{r.push(this.on(h,n))}),e>0&&(i=setTimeout(()=>{n(),s(!1)},e))})}};export{u as EventEmitterExt};
